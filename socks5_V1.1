#!/bin/bash

clear
echo "Updating system..."
apt update -y >/dev/null 2>&1
apt install -y dante-server net-tools curl ufw >/dev/null 2>&1

echo "========================================"
echo "   MASUKKAN USER DAN PASS NYA BRE!!!"
echo "========================================"

exec < /dev/tty
read -p "Enter username: " user
read -s -p "Enter password: " pass
echo ""
echo "========================================"

# Buat user
useradd -m "$user" >/dev/null 2>&1
echo "$user:$pass" | chpasswd

# Ambil interface aktif dan IP VPS
iface=$(ip route get 1.1.1.1 | awk '{print $5; exit}')
vpsip=$(curl -s ifconfig.me)

# Buat file konfigurasi danted
cat > /etc/danted.conf <<EOF
logoutput: syslog
internal: 0.0.0.0 port = 8443
external: $iface
method: username
user.privileged: root
user.unprivileged: nobody
user.libwrap: nobody

client pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: connect disconnect error
    method: username
}

socks pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: connect disconnect error
    method: username
}
EOF

# Buka port di firewall
ufw allow 8443/tcp >/dev/null 2>&1 || iptables -I INPUT -p tcp --dport 8443 -j ACCEPT

# Restart danted dan enable autostart
systemctl restart danted
systemctl enable danted >/dev/null 2>&1

# Output hasil
echo ""
echo "   âœ… AUTO SOCKS5 by DMSRYN ðŸ”¥"
echo "========================================"
echo " SOCKS5 INFO:"
echo " IP       : $vpsip"
echo " PORT     : 8443"
echo " USER     : $user"
echo " PASS     : $pass"
echo "========================================"
echo "   GUNAKAN DENGAN BIJAK YA BREEE :)"
echo ""

